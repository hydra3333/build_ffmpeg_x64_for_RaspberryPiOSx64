# build script for x64 ffmpeg on the Pi4 with 64-bit OS which enables h264_v4l2m2m  ?

# perhaps see these
# https://forums.raspberrypi.com/viewtopic.php?p=1776531#p1776531
# https://gist.github.com/wildrun0/86a890585857a36c90110cee275c45fd


### NOTES
#
# We build some libraries form source, but not all.
# Those we do build is because it is the LATEST rather than 
# whatever old version may be in Raspberry Pi debian bullseye x64 repositories
# NOTE NOTE NOTE NOTE we need to 64-bit-ize all of the builds  !!!
# example use:
#/home/pi/FFmpeg/ffmpeg -i /home/pi/final.mp4 -c:v h264_v4l2m2m -b:v 8M -c:a copy test.mp4



### PREPARE
# Before we get started, let’s create a directory where we will store the code for each of the libraries.
#
cd ~/Desktop
mkdir ~/Desktop/ffmpeg_libraries


### Install the ffmpeg and dependency build prerequisites
#
sudo apt -y update
sudo apt -y full-upgrade
sudo apt -y install autoconf
sudo apt -y install autopoint
sudo apt -y install automake
sudo apt -y install gettext
sudo apt -y install build-essential
sudo apt -y install cmake
sudo apt -y install cmake-curses-gui
sudo apt -y install doxygen
sudo apt -y install git
sudo apt -y install graphviz
sudo apt -y install imagemagick
sudo apt -y install libasound2-dev
sudo apt -y install libass-dev
sudo apt -y install libavcodec-dev
sudo apt -y install libavdevice-dev
sudo apt -y install libavfilter-dev
sudo apt -y install libavformat-dev
sudo apt -y install libavutil-dev
sudo apt -y install libfreetype6-dev
sudo apt -y install libgnutls28-dev
sudo apt -y install libunistring-dev
sudo apt -y install libgmp-dev
sudo apt -y install libmp3lame-dev
sudo apt -y install libfdk-aac-dev
sudo apt -y install libopencore-amrnb-dev
sudo apt -y install libopencore-amrwb-dev
sudo apt -y install libopus-dev
sudo apt -y install librtmp-dev
sudo apt -y install libsdl2-dev
sudo apt -y install libsdl2-image-dev
sudo apt -y install libsdl2-mixer-dev
sudo apt -y install libsdl2-net-dev
sudo apt -y install libsdl2-ttf-dev
sudo apt -y install libsnappy-dev
sudo apt -y install libsoxr-dev
sudo apt -y install libssh-dev
sudo apt -y install libssl-dev
sudo apt -y install libtool
sudo apt -y install libv4l-dev
sudo apt -y install libva-dev
sudo apt -y install libvdpau-dev
sudo apt -y install libvo-amrwbenc-dev
sudo apt -y install libvorbis-dev
sudo apt -y install libwebp-dev
sudo apt -y install libdrm-dev
sudo apt -y install libvpx-dev
sudo apt -y install libx264-dev
sudo apt -y install libx265-dev
sudo apt -y install libxcb-shape0-dev
sudo apt -y install libxcb-shm0-dev
sudo apt -y install libxcb-xfixes0-dev
sudo apt -y install libxcb1-dev
sudo apt -y install libxml2-dev
sudo apt -y install lzma-dev
sudo apt -y install meson
sudo apt -y install nasm
sudo apt -y install pkg-config
sudo apt -y install python3-dev
sudo apt -y install python3-pip
sudo apt -y install texinfo
sudo apt -y install wget
sudo apt -y install yasm
sudo apt -y install zlib1g-dev


# FFTW3
# FFTW3 is a free collection of fast C routines for computing the Discrete Fourier Transform in one or more dimensions.
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fv fftw-3.3.10.tar.gz
rm -fvR ~/Desktop/ffmpeg_libraries/fftw-3.3.10
wget https://fossies.org/linux/misc/fftw-3.3.10.tar.gz
tar -xf fftw-3.3.10.tar.gz
cd ~/Desktop/ffmpeg_libraries/fftw-3.3.10
export CFLAGS=" -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -D_FORTIFY_SOURCE=2 "
# The Raspberry Pi 4, like the Pi3/3+ it contains an Armv8 CPU.  TEST: assume an Arm8 operating system (64bit) and use ARM8 instructions
./configure --disable-shared --enable-static --disable-silent-rules --disable-doc --disable-alloca --with-our-malloc --disable-fortran \
			--disable-sse --disable-sse2 --disable-avx --disable-avx2 --disable-avx512 --disable-avx-128-fma --disable-altivec --disable-vsx \
			--enable-neon --with-pic \
			--enable-threads --with-combined-threads --disable-float --disable-long-double -disable-quad-precision \
			--enable-armv8-pmccntr-el0 --enable-armv8-cntvct-el0
make -j$(nproc)
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS


### ICONV
# used to convert between different character encodings. 
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fv libiconv-1.16.tar.gz
rm -fvR ~/Desktop/ffmpeg_libraries/libiconv-1.16
wget https://fossies.org/linux/misc/libiconv-1.16.tar.gz
tar -xf libiconv-1.16.tar.gz
cd ~/Desktop/ffmpeg_libraries/libiconv-1.16
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
./configure --disable-shared --enable-static --disable-nls --enable-extra-encodings
make -j$(nproc)
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS


# XZ
# XZ Utils provide a general-purpose data-compression library
# xz depends on iconv
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fvR ~/Desktop/ffmpeg_libraries/xz
git clone --depth 1 https://github.com/xz-mirror/xz ~/Desktop/ffmpeg_libraries/xz
cd ~/Desktop/ffmpeg_libraries/xz
export CFLAGS=" -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -D_FORTIFY_SOURCE=2 "
sh ./autogen.sh
./configure --disable-shared --enable-static --disable-xz --disable-xzdec --disable-lzmadec --disable-lzmainfo --disable-doc
make -j$(nproc)
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS


### ZIMG
# This library implements a range of image processing features, dealing with the basics of scaling, colorspace, and depth.
# Clone and compile the code by running the command below.
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fvR ~/Desktop/ffmpeg_libraries/zimg
git clone --depth 1 https://github.com/sekrit-twc/zimg.git ~/Desktop/ffmpeg_libraries/zimg
cd ~/Desktop/ffmpeg_libraries/zimg
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
sh ./autogen.sh 
./configure --disable-shared --enable-static 
make -j$(nproc)
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS


### LIBFLAC
# libFLAC is an Open Source lossless audio codec 
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fvR ~/Desktop/ffmpeg_libraries/libflac
git clone --depth 1 https://github.com/xiph/flac.git ~/Desktop/ffmpeg_libraries/libflac
mkdir -pv ~/Desktop/ffmpeg_libraries/libflac/_build
cd ~/Desktop/ffmpeg_libraries/libflac
cd ~/Desktop/ffmpeg_libraries/libflac/_build
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
#-DHAVE_SQLITE3=ON 
cmake -G "Unix Makefiles" .. -DENABLE_64_BIT_WORDS=ON -DBUILD_PROGRAMS=OFF -DINSTALL_PKGCONFIG_MODULES=ON -DINSTALL_MANPAGES=OFF -DBUILD_SHARED_LIBS=OFF -DBUILD_TESTING=OFF -DBUILD_EXAMPLES=OFF -DVERSION=1.3.4 -DCMAKE_BUILD_TYPE=Release
make -j$(nproc)
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS


### SQLITE3
# SQLITE3is a software library that implements a self-contained, serverless, zero-configuration, transactional SQL database engine
#
{
	'repo_type' : 'archive',
	'download_locations' : [ # https://fossies.org/linux/misc/
		#{ 'url' : 'https://www.sqlite.org/2021/sqlite-autoconf-3370100.tar.gz', 'hashes' : [ { 'type' : 'sha256', 'sum' : '40f22a13bf38bbcd4c7ac79bcfb42a72d5aa40930c1f3f822e30ccce295f0f2e' }, ], },
		#{ 'url' : 'https://fossies.org/linux/misc/sqlite-autoconf-3370100.tar.gz', 'hashes' : [ { 'type' : 'sha256', 'sum' : '40f22a13bf38bbcd4c7ac79bcfb42a72d5aa40930c1f3f822e30ccce295f0f2e' }, ], },
		{ 'url' : 'https://www.sqlite.org/2021/sqlite-autoconf-3370200.tar.gz', 'hashes' : [ { 'type' : 'sha256', 'sum' : '4089a8d9b467537b3f246f217b84cd76e00b1d1a971fe5aca1e30e230e46b2d8' }, ], },
		{ 'url' : 'https://fossies.org/linux/misc/sqlite-autoconf-3370200.tar.gz', 'hashes' : [ { 'type' : 'sha256', 'sum' : '4089a8d9b467537b3f246f217b84cd76e00b1d1a971fe5aca1e30e230e46b2d8' }, ], },
	],
	'cflag_addition' : '-fexceptions -DSQLITE_ENABLE_COLUMN_METADATA=1 -DSQLITE_USE_MALLOC_H=1 -DSQLITE_USE_MSIZE=1 -DSQLITE_DISABLE_DIRSYNC=1 -DSQLITE_ENABLE_RTREE=1 -fno-strict-aliasing',
	'strip_cflags': ['-ffast-math', ],
	'configure_options': '{autoconf_prefix_options} --enable-threadsafe --disable-editline --enable-readline --enable-json1 --enable-fts5 --enable-session',
	'depends_on': (
		'zlib',
	),
	'update_check' : { 'url' : 'https://www.sqlite.org/index.html', 'type' : 'httpregex', 'regex' : r'<a href="releaselog/.*\.html">Version (?P<version_num>[\d.]+)<\/a>' },
	'_info' : { 'version' : '3.37.2', 'fancy_name' : 'libsqlite3' },
}
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fvR ~/Desktop/ffmpeg_libraries/sqlite-autoconf-3370200
wget https://fossies.org/linux/misc/sqlite-autoconf-3370200.tar.gz
tar -xf sqlite-autoconf-3370200.tar.gz
cd ~/Desktop/ffmpeg_libraries/sqlite-autoconf-3370200
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 -fexceptions -DSQLITE_ENABLE_COLUMN_METADATA=1 -DSQLITE_USE_MALLOC_H=1 -DSQLITE_USE_MSIZE=1 -DSQLITE_DISABLE_DIRSYNC=1 -DSQLITE_ENABLE_RTREE=1 -fno-strict-aliasing "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 -fexceptions -DSQLITE_ENABLE_COLUMN_METADATA=1 -DSQLITE_USE_MALLOC_H=1 -DSQLITE_USE_MSIZE=1 -DSQLITE_DISABLE_DIRSYNC=1 -DSQLITE_ENABLE_RTREE=1 -fno-strict-aliasing "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 -fexceptions -DSQLITE_ENABLE_COLUMN_METADATA=1 -DSQLITE_USE_MALLOC_H=1 -DSQLITE_USE_MSIZE=1 -DSQLITE_DISABLE_DIRSYNC=1 -DSQLITE_ENABLE_RTREE=1 -fno-strict-aliasing "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 -fexceptions -DSQLITE_ENABLE_COLUMN_METADATA=1 -DSQLITE_USE_MALLOC_H=1 -DSQLITE_USE_MSIZE=1 -DSQLITE_DISABLE_DIRSYNC=1 -DSQLITE_ENABLE_RTREE=1 -fno-strict-aliasing "
./configure --disable-shared --enable-static --enable-threadsafe --disable-editline --enable-readline --enable-json1 --enable-fts5 --enable-session
make -j$(nproc)
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS











### LIBOPUS
{
	'repo_type' : 'git',
	'url' : 'https://github.com/xiph/opus.git',
	'depth_git': 0,
	'strip_cflags': ['-ffast-math', ],
	'conf_system' : 'cmake',
	'source_subfolder' : '_build',
	'configure_options' : '.. {cmake_prefix_options} -DCMAKE_INSTALL_PREFIX={target_prefix} -DOPUS_X86_MAY_HAVE_SSE=1 -DOPUS_X86_MAY_HAVE_SSE2=1 -DOPUS_X86_MAY_HAVE_SSE4_1=1 -DOPUS_X86_MAY_HAVE_AVX=1 -DOPUS_X86_PRESUME_SSE=1 -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=0 -DBUILD_TESTING=0 -DOPUS_CUSTOM_MODES=1 -DOPUS_BUILD_PROGRAMS=0 -DOPUS_INSTALL_PKG_CONFIG_MODULE=1',
	'regex_replace': {
		'post_install': [
			{
				0: r'^(Libs: -L).+ (-lopus)([\n\r\s]+)?$',
				1: r'\1${{libdir}} \2 -lssp\3',
				'in_file': '{pkg_config_path}/opus.pc'
			},
		],
	},
	'update_check' : { 'type' : 'git', },
	'_info' : { 'version' : 'git (master)', 'fancy_name' : 'opus' },
}


### LIBSAMPLERATE
{
	'repo_type' : 'git',
	'url' : 'https://github.com/erikd/libsamplerate.git',
	'conf_system' : 'cmake',
	'source_subfolder' : '_build',
	'configure_options' : '.. {cmake_prefix_options} -DCMAKE_INSTALL_PREFIX={target_prefix} -DLIBSAMPLERATE_EXAMPLES=OFF -DLIBSAMPLERATE_TESTS=OFF -DBUILD_SHARED_LIBS=0 -DCMAKE_BUILD_TYPE=Release',
	'depends_on' : ['libflac', 'fftw3', 'libopus',], # 2019.12.13 chanaged fftw to fftw3
	'update_check' : { 'type' : 'git', },
	'_info' : { 'version' : 'git (master)', 'fancy_name' : 'libsamplerate' },
}


### LIBOGG
{
	'repo_type' : 'git',
	'url' : 'https://github.com/xiph/ogg.git',
	'conf_system' : 'cmake',
	'source_subfolder' : '_build',
	'configure_options' : '.. {cmake_prefix_options} -DCMAKE_INSTALL_PREFIX={target_prefix} -DBUILD_SHARED_LIBS=0 -DCMAKE_BUILD_TYPE=Release',
	'update_check' : { 'type' : 'git', },
	'_info' : { 'version' : 'git (master)', 'fancy_name' : 'ogg' },
}


### LIBVORBIS
# depends_on': ['libogg',],
{
	'repo_type' : 'git',
	'url' : 'https://github.com/xiph/vorbis.git',
	#'depth_git' : 0,
	#'branch' : '30c490373b740f357d219c9e9672698d739f11f3', # 2020.04.08 something broke after this commit :(
	'conf_system' : 'cmake',
	'source_subfolder' : '_build',
	'configure_options' : '.. {cmake_prefix_options} -DCMAKE_INSTALL_PREFIX={target_prefix} -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF ',
	#'configure_options' : '.. {cmake_prefix_options} -DCMAKE_INSTALL_PREFIX={target_prefix} -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF -DINSTALL_CMAKE_PACKAGE_MODULE=ON ',
	'regex_replace': {
		'post_install': [
			# {
			# 	0: r'Libs: -L${{libdir}} -lvorbisenc[^\n]+',
			# 	1: r'Libs: -L${{libdir}} -lvorbisenc -lvorbis -logg',
			# 	'in_file': '{pkg_config_path}/vorbisenc.pc'
			# },
			# {
			# 	0: r'Libs: -L${{libdir}} -lvorbis[^\n]+',
			# 	1: r'Libs: -L${{libdir}} -lvorbis -logg',
			# 	'in_file': '{pkg_config_path}/vorbis.pc'
			# }
			{
				0: r'Requires\.private:',
				1: r'Requires:',
				'in_file': '{pkg_config_path}/vorbisenc.pc'
			},
			{
				0: r'Requires\.private:',
				1: r'Requires:',
				'in_file': '{pkg_config_path}/vorbis.pc'
			},
		]
	},
	'depends_on': ['libogg',],
	'update_check' : { 'type' : 'git', },
	'_info' : { 'version' : 'git (master)', 'fancy_name' : 'vorbis' },
}




### VAMP_PLUGIN
{
	'repo_type' : 'archive',
	'download_locations' : [
		{ 'url' : 'https://raw.githubusercontent.com/hydra3333/h3333_python_cross_compile_script_v100/master/sources/vamp-plugin-sdk-2.9.0.tar.gz', 'hashes' : [ { 'type' : 'sha256', 'sum' : 'b72a78ef8ff8a927dc2ed7e66ecf4c62d23268a5d74d02da25be2b8d00341099' }, ], }, # 2019.12.13
		{ 'url' : 'https://code.soundsoftware.ac.uk/attachments/download/2588/vamp-plugin-sdk-2.9.0.tar.gz', 'hashes' : [ { 'type' : 'sha256', 'sum' : 'b72a78ef8ff8a927dc2ed7e66ecf4c62d23268a5d74d02da25be2b8d00341099' }, ], },
	],
	'run_post_regexreplace' : [
		'cp -fv build/Makefile.mingw64 Makefile',
	],
	'patches' : [
		('vamp/vamp-plugin-sdk-2.7.1.patch','-p0'), #They rely on M_PI which is gone since c99 or w/e, give them a self defined one and hope for the best.
	],
	'build_options' : '{make_prefix_options} sdkstatic', # for DLL's add 'sdk rdfgen'
	'needs_make_install' : False, # doesnt s support xcompile installing
	'run_post_build' : [ # lets install it manually then I guess?
		'cp -fv libvamp-sdk.a "{target_prefix}/lib/"',
		'cp -fv libvamp-hostsdk.a "{target_prefix}/lib/"',
		'cp -frv vamp-hostsdk/ "{target_prefix}/include/"',
		'cp -frv vamp-sdk/ "{target_prefix}/include/"',
		'cp -frv vamp/ "{target_prefix}/include/"',
		'cp -fv pkgconfig/vamp.pc.in "{target_prefix}/lib/pkgconfig/vamp.pc"',
		'cp -fv pkgconfig/vamp-hostsdk.pc.in "{target_prefix}/lib/pkgconfig/vamp-hostsdk.pc"',
		'cp -fv pkgconfig/vamp-sdk.pc.in "{target_prefix}/lib/pkgconfig/vamp-sdk.pc"',
		'sed -i.bak \'s/\%PREFIX\%/{target_prefix_sed_escaped}/\' "{pkg_config_path}/vamp.pc"',
		'sed -i.bak \'s/\%PREFIX\%/{target_prefix_sed_escaped}/\' "{pkg_config_path}/vamp-hostsdk.pc"',
		'sed -i.bak \'s/\%PREFIX\%/{target_prefix_sed_escaped}/\' "{pkg_config_path}/vamp-sdk.pc"',
	],
	'depends_on' : ['libsndfile',],
	'update_check' : { 'url' : 'https://vamp-plugins.org/develop.html', 'type' : 'httpregex', 'regex' : r'.*<ul><li>Download the <b>Vamp plugin SDK<\/b> \(version (?P<version_num>[\d.]+)\):.*' },
	# { 'url' : 'https://code.soundsoftware.ac.uk/projects/vamp-plugin-sdk/files/', 'type' : 'httpindex', 'regex' : r'	vamp-plugin-sdk-(?P<version_num>[\d.]+)\.tar\.gz', },
	'_info' : { 'version' : '2.9.0', 'fancy_name' : 'vamp-plugin-sdk' },
}





### LIBSNDFILE
# libsndfile is a C library for reading and writing files containing sampled audio data
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fvR ~/Desktop/ffmpeg_libraries/libsndfile
git clone --depth 1 https://github.com/libsndfile/libsndfile.git ~/Desktop/ffmpeg_libraries/libsndfile
mkdir -pv ~/Desktop/ffmpeg_libraries/libsndfile/_build
cd ~/Desktop/ffmpeg_libraries/libsndfile/_build
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
#-DHAVE_SQLITE3=ON 
cmake -G "Unix Makefiles" .. -DBUILD_SHARED_LIBS=OFF -DBUILD_PROGRAMS=OFF -DBUILD_TESTING=OFF -DBUILD_EXAMPLES=OFF -DENABLE_BOW_DOCS=OFF -DENABLE_PACKAGE_CONFIG=ON -DCMAKE_BUILD_TYPE=Release -DENABLE_STATIC_RUNTIME=ON -DHAVE_ALSA_ASOUNDLIB_H=OFF -DENABLE_EXTERNAL_LIBS=ON
make -j$(nproc)
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS




### RUBBERBAND
# An audio time-stretching and pitch-shifting library and utility program.
# depends on 'libsamplerate', 'libopus', 'libogg', 'libvorbis', 'libflac', 'libsndfile', 'vamp_plugin', 'fftw3'
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fvR ~/Desktop/ffmpeg_libraries/rubberband
wget https://raw.githubusercontent.com/hydra3333/h3333_python_cross_compile_script_v100/master/additional_headers/ladspa.h
sudo mv -fv ladspa.h /usr/local/include/ladspa.h
git clone --depth 1 https://github.com/breakfastquay/rubberband.git ~/Desktop/ffmpeg_libraries/rubberband
mkdir -pv ~/Desktop/ffmpeg_libraries/rubberband/build
cd ~/Desktop/ffmpeg_libraries/rubberband
cd ~/Desktop/ffmpeg_libraries/rubberband/build
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
meson ./ .. --backend=ninja --default-library=static --buildtype=release --strip -Dno_shared=true 
ninja
sudo ninja install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS






### FDK-AAC
# Compile the Fraunhofer FDK AAC library.
# Compiling this library will allow FFmpeg to have support for the AAC sound format.
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fvR ~/Desktop/ffmpeg_libraries/fdk-aac
git clone --depth 1 https://github.com/mstorsjo/fdk-aac.git ~/Desktop/ffmpeg_libraries/fdk-aac
cd ~/Desktop/ffmpeg_libraries/fdk-aac
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
autoreconf -fiv
./configure --disable-shared --enable-static
make -j$(nproc)
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS


### LAME
# For mp3 encoding
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fv lame-3.100.tar.gz
rm -fvR ~/Desktop/ffmpeg_libraries/lame-3.100
wget https://fossies.org/linux/misc/lame-3.100.tar.gz
tar -xf lame-3.100.tar.gz
cd ~/Desktop/ffmpeg_libraries/lame-3.100
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
autoreconf -fiv
./configure --disable-shared --enable-static --enable-nasm --disable-frontend
make -j$(nproc)
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS


### TWOLAME
# TwoLAME is an optimized MPEG Audio Layer 2 (MP2) encoder
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fv twolame-0.4.0.tar.gz
rm -fvR ~/Desktop/ffmpeg_libraries/twolame-0.4.0
wget https://github.com/njh/twolame/releases/download/0.4.0/twolame-0.4.0.tar.gz
tar -xf twolame-0.4.0.tar.gz
cd ~/Desktop/ffmpeg_libraries/twolame-0.4.0
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
autoreconf -fiv
./configure --disable-shared --enable-static CPPFLAGS=-DLIBTWOLAME_STATIC
make -j$(nproc)
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS


### DAV1D
# This library will add support for decoding the AV1 video format into FFmpeg. 
# This codec is considered the successor of the VP9 codec and as a competitor to the x265 codec.
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fvR ~/Desktop/ffmpeg_libraries/dav1d
git clone --depth 1 https://code.videolan.org/videolan/dav1d.git ~/Desktop/ffmpeg_libraries/dav1d
mkdir -pv ~/Desktop/ffmpeg_libraries/dav1d/build
cd ~/Desktop/ffmpeg_libraries/dav1d/build
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
meson ./ .. --backend=ninja --default-library=static --strip -Denable_tests=false -Denable_tools=false --buildtype=release
ninja
sudo ninja install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS


### LIBX264 multibit
# This library will add support for libx264 encoding 
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fvR ~/Desktop/ffmpeg_libraries/libx264
git clone --depth 1 https://code.videolan.org/videolan/x264.git ~/Desktop/ffmpeg_libraries/libx264
mkdir -pv ~/Desktop/ffmpeg_libraries/libx264
cd ~/Desktop/ffmpeg_libraries/libx264
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
./configure --enable-static --enable-strip --enable-lto --enable-pic --bit-depth=all --chroma-format=all --disable-win32thread --extra-cflags="-DLIBXML_STATIC" --extra-cflags="-DGLIB_STATIC_COMPILATION" --disable-cli --disable-lavf --disable-avs --disable-ffms --disable-gpac --disable-lsmash --disable-opencl
make -j$(nproc)
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS


### LIBX265 multibit
# This library will add support for libx265 encoding 
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fvR ~/Desktop/ffmpeg_libraries/libx265
git clone --depth 1 https://bitbucket.org/multicoreware/x265_git ~/Desktop/ffmpeg_libraries/libx265
#
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
#
cd ~/Desktop/ffmpeg_libraries/libx265/build/linux
mkdir -pv 8bit
mkdir -pv 10bit
mkdir -pv 12bit
#
cd 12bit
cmake -G "Unix Makefiles" ../../../source -DENABLE_ASSEMBLY=ON -DHIGH_BIT_DEPTH=ON -DENABLE_HDR10_PLUS=ON -DEXPORT_C_API=OFF -DENABLE_SHARED=OFF -DENABLE_CLI=OFF -DMAIN12=ON \
		-DLIBXML_STATIC=ON -DGLIB_STATIC_COMPILATION=ON -DENABLE_HDR10_PLUS=ON
make -j$(nproc)
sudo make install
mv -fv "./libx265.a" "./libx265_main12.a"
#
cd ../10bit
cmake -G "Unix Makefiles" ../../../source -DENABLE_ASSEMBLY=ON -DHIGH_BIT_DEPTH=ON -DENABLE_HDR10_PLUS=ON -DEXPORT_C_API=OFF -DENABLE_SHARED=OFF -DENABLE_CLI=OFF \
		-DLIBXML_STATIC=ON -DGLIB_STATIC_COMPILATION=ON -DENABLE_HDR10_PLUS=ON
make -j$(nproc)
sudo make install
mv -fv "./libx265.a" "./libx265_main10.a"
#
cd ../8bit
#ln -sf ../10bit/libx265.a libx265_main10.a
#ln -sf ../12bit/libx265.a libx265_main12.a
#-DEXTRA_LIB="x265_main10.a;x265_main12.a" -DEXTRA_LINK_FLAGS=-L.
cmake -G "Unix Makefiles" ../../../source -DENABLE_ASSEMBLY=ON -DENABLE_SHARED=OFF -DENABLE_CLI:BOOL=OFF \
		-DEXTRA_LIB="x265_main10.a;x265_main12.a" \
		-DEXTRA_LINK_FLAGS="-L.;-L../10bit;-L../12bit" \
		-DLINKED_10BIT=ON -DLINKED_12BIT=ON \
		-DLIBXML_STATIC=ON -DGLIB_STATIC_COMPILATION=ON -DENABLE_HDR10_PLUS=ON
make -j$(nproc)
sudo make install
mv -fv "./libx265.a" "./libx265_main.a"
#
#cp -fv "../8bit/libx265_main.a"        ./libx265_main.a
cp -fv "../10bit/libx265_main10.a"      ./libx265_main10.a
cp -fv "../12bit/libx265_main12.a"      ./libx265_main12.a
rm -fv ./libx265.a
ls -al
ar -M <<EOF
CREATE libx265.a
ADDLIB libx265_main.a
ADDLIB libx265_main10.a
ADDLIB libx265_main12.a
SAVE
END
EOF
#sudo cp -fv ./libx265.a /usr/local/lib/libx265.a
# re-install the new composite libx265.a created by "ar"
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS
cd ~/Desktop/ffmpeg_libraries/libx265


# LIBVPX
# Support for the VP8 and VP9 video codecs on our Raspberry Pi.
# This library we are compiling is called LibVPX and is developed by Google.
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fvR ~/Desktop/ffmpeg_libraries/libvpx
git clone --depth 1 https://chromium.googlesource.com/webm/libvpx ~/Desktop/ffmpeg_libraries/libvpx
cd ~/Desktop/ffmpeg_libraries/libvpx
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
./configure --disable-shared --enable-static --enable-webm-io --enable-libyuv --enable-vp9 --enable-vp8 --enable-postproc --enable-vp9-highbitdepth --enable-vp9-postproc --enable-postproc-visualizer --enable-error-concealment --enable-better-hw-compatibility --enable-multi-res-encoding --enable-vp9-temporal-denoising --disable-tools --disable-docs --disable-examples --disable-install-docs --disable-unit-tests --disable-decode-perf-tests --disable-encode-perf-tests
make -j$(nproc)
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS


### kvazaar
# This library that we are going to compile next is an HEVC encoder called “kvazaar“.
#
#cd ~/Desktop
#rm -fvR ~/Desktop/ffmpeg_libraries/kvazaar
#git clone --depth 1 https://github.com/ultravideo/kvazaar.git ~/Desktop/ffmpeg_libraries/kvazaar
#cd ~/Desktop/ffmpeg_libraries/kvazaar
#export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
#export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
#export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
#export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
#sh ./autogen.sh
#./configure
#make -j$(nproc)
#sudo make install
#export -n CFLAGS
#export -n CXXFLAGS
#export -n CPPFLAGS
#export -n LDFLAGS


# LIBAOM
# This library will allow us to add support for encoding to the AP1 video codec on your Raspberry Pi.
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fvR ~/Desktop/ffmpeg_libraries/aom
git clone --depth 1 https://aomedia.googlesource.com/aom ~/Desktop/ffmpeg_libraries/aom
mkdir -pv ~/Desktop/ffmpeg_libraries/aom/aom_build
cd ~/Desktop/ffmpeg_libraries/aom/aom_build
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
##cmake -G "Unix Makefiles" AOM_SRC -DENABLE_NASM=on -DPYTHON_EXECUTABLE="$(which python3)" -DCMAKE_C_FLAGS="-mfpu=vfp -mfloat-abi=hard" ..
##sed -i 's/ENABLE_NEON:BOOL=ON/ENABLE_NEON:BOOL=OFF/' CMakeCache.txt
cmake -G "Unix Makefiles" AOM_SRC -DPYTHON_EXECUTABLE="$(which python3)" -DBUILD_SHARED_LIBS=0 -DCONFIG_STATIC=1 -DCONFIG_SHARED=0 \
-DFORCE_HIGHBITDEPTH_DECODING=1 -DCONFIG_AV1_HIGHBITDEPTH=1 -DHAVE_PTHREAD_H=1 -DCONFIG_LIBYUV=1 -DCONFIG_MULTITHREAD=1 -DCONFIG_PIC=1 \
-DCONFIG_COEFFICIENT_RANGE_CHECKING=1 -DCONFIG_DENOISE=1 -DCONFIG_WEBM_IO=1 -DCONFIG_SPATIAL_RESAMPLING=1 -DENABLE_NASM=ON \
-DCONFIG_AV1_DECODER=1 -DCONFIG_AV1_ENCODER=1 -DENABLE_TOOLS=0 -DENABLE_EXAMPLES=0 -DENABLE_DOCS=0 -DENABLE_TESTS=0 -DENABLE_TESTDATA=0 \
-DAOM_EXTRA_C_FLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 " \
-DAOM_EXTRA_CXX_FLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 " -DLIBXML_STATIC=1 -DGLIB_STATIC_COMPILATION=1  \
..
make -j$(nproc)
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS


### UPDATE THE LINK CACHE
# This command ensures we won’t run into linking issues because the compiler can’t find a library.
#
cd ~/Desktop
sudo ldconfig


### FFMPEG
# During the compilation, we will be enabling all the extra libraries that we compiled and installed in the previous two sections.
#
cd ~/Desktop
mkdir -pv ~/Desktop/ffmpeg_libraries
cd ~/Desktop/ffmpeg_libraries
rm -fvR ~/Desktop/ffmpeg_libraries/FFmpeg
git clone --branch release/4.4 --depth 1 https://github.com/FFmpeg/FFmpeg.git ~/Desktop/ffmpeg_libraries/FFmpeg
cd ~/Desktop/ffmpeg_libraries/FFmpeg
export CFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CXXFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export CPPFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
export LDFLAGS=" -O3 -fstack-protector-all -D_FORTIFY_SOURCE=2 "
# on configure:
#	--bindir=/usr/local/bin
# on make: 
#	ARCH=aarch64 CROSS_COMPILE=aarch64-linux-gnu-


./configure \
	--extra-version=hydra3333_RPi4B_for_h264_v4l2m2m \
	--disable-shared --enable-static \
	--extra-cflags="-I/usr/local/include" \
	--extra-ldflags="-L/usr/local/lib" \
	--extra-libs="-lpthread -lm -latomic" \
	--enable-gpl --enable-version3 --enable-nonfree \
	--arch=aarch64 --target-os=linux \
	--pkg-config=pkg-config \
	--pkg-config-flags=--static \
	--enable-hardcoded-tables \
	--enable-gmp \
	--enable-gnutls
	--enable-libaom \
	--enable-libass \
	--enable-libdav1d \
	--enable-libdrm \
	--enable-libfdk-aac \
	--enable-libmp3lame \
	--enable-libtwolame \
	--enable-libfreetype \
	--enable-libkvazaar \
	--enable-libopencore-amrnb \
	--enable-libopencore-amrwb \
	--enable-libopus \
	--enable-librtmp \
	--enable-libsnappy \
	--enable-libsoxr \
	--enable-libssh \
	--enable-libvorbis \
	--enable-libvpx \
	--enable-libzimg \
	--enable-libwebp \
	--enable-libx264 \
	--enable-libx265 \
	--enable-libxml2 \
	--enable-openssl \
	--enable-h264_v4l2m2m \
	--enable-librubberband \
	--enable-zlib \
	--enable-lzma \	
	--enable xvidcore \
	--enable-libxvid \
	--enable-pthreads --disable-w32threads \
	--extra-cflags="-DLIBTWOLAME_STATIC" \
	--extra-cflags="-DLIBXML_STATIC"
make -j$(nproc) \
sudo make install
export -n CFLAGS
export -n CXXFLAGS
export -n CPPFLAGS
export -n LDFLAGS
  




--------------------------------
to do
fftw3
libx264
libx265

